<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-meta/iron-meta.html">

<script>
(function () {
	window.Quirkbot = window.Quirkbot || {};
	window.Quirkbot.UtilsBehavior = {
		UtilsBehavior: true,
		getDeep: function(object, path){
			try{
				var paths = path.split('.');
				var current = object;
				var i;

				for (i = 0; i < paths.length; ++i) {
					if (current[paths[i]] === undefined) {
						return;
					} else {
						current = current[paths[i]];
					}
				}
				return current;
			}
			catch(e){
				return;
			}
		},
		/**
		 * Dom utils
		 **/
		hitTest: function(element, x, y){
			var box = element.getBoundingClientRect();
			if(x < box.left || x > (box.left + box.width) || y < box.top || y > (box.top + box.height)){
				return false;
			}
			return true;
		},
		/**
		 * Polymer helpers
		 **/
		resolveIconName: function(name, iconset){
			var set = new Polymer.IronMetaQuery({type: 'iconset', key: iconset}).value;
			var iconNames = set.getIconNames();
			var index = iconNames.indexOf(iconset + ':' + name);
			if(index !== -1){
				return iconNames[index];
			}

			index = iconNames.indexOf(iconset + ':' + 'undefined');
			if(index !== -1){
				return iconNames[index];
			}
			return '';
		},
		/**
		 * Searching arrays of objects
		 **/
		 findIndexesByKey: function(list, path, value) {
			var result = [];
 			if(!list || !list.length){
 				return result;
 			}

 			for (var i = 0; i < list.length; i++) {
 				if(this.getDeep(list[i], path) === value){
 					result.push(i);
 				}
 			}
 			return result;
 		},
		findObjectsByKey: function(list, path, value) {
			var indexes = this.findIndexesByKey(list, path, value);
			return	indexes.map(function(index){
				return list[index];
			});
		},
		findOneIndexByKey: function(list, path, value) {
			if(!list || !list.length){
				return -1;
			}

			for (var i = 0; i < list.length; i++) {
				if(this.getDeep(list[i], path) === value){
					return i;
				}
			}
			return -1;
		},
		findOneObjectByKey: function(list, path, value) {
			if(!list || !list.length){
				return;
			}
			var index = this.findOneIndexByKey(list, path, value);
			return	list[index];
		},
		/**
		 * Filters and sorters for arrays of objects
		 **/
		sortByKey: function (key, a, b) {
			if(!a[key] && !b[key]){
				return 0;
			}
			else if(!a[key]){
				return -1;
			}
			else if(!b[key]){
				return 1;
			}
			var aValue = a[key].toUpperCase();
			var bValue = b[key].toUpperCase();
			if(aValue < bValue){
				return -1;
			}
			else if(aValue > bValue){
				return 1;
			}
			return 0;
		},
		sortByName: function (a, b) {
			return this.sortByKey('name', a, b);
		},
		/**
		 * String utils
		 **/
		lTrimNumerals : function(string){
			while (parseInt(string.charAt(0)).toString() === string.charAt(0)) {
				string = string.substring(string.length, 1);
			}
			return string;
		},
		rTrimNumerals : function(string){
			while (parseInt(string.charAt(string.length-1)).toString() === string.charAt(0)) {
				string = string.substring(string.length-1, 0);
			}
			return string;
		},
		trimNumerals: function(string){
			return this.lTrimNumerals(this.rTrimNumerals(string));
		},
		lTrimSpaces : function(string){
			while (string.charAt(0) === ' ') {
				string = string.substring(string.length, 1);
			}
			return string;
		},
		rTrimSpaces : function(string){
			while (string.charAt(string.length-1) === ' ') {
				string = string.substring(string.length-1, 0);
			}
			return string;
		},
		trimSpaces: function(string){
			return this.lTrimSpaces(this.rTrimSpaces(string));
		}
	};
})();
</script>
