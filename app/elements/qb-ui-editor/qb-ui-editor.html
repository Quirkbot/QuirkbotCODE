<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">

<link rel="import" href="../qb-ui-editor-visual/qb-ui-editor-visual.html">
<link rel="import" href="../qb-ui-editor-text/qb-ui-editor-text.html">
<link rel="import" href="../qb-ui-nodes-menu/qb-ui-nodes-menu.html">

<dom-module id='qb-ui-editor'>
	<style>
		:host{
			display: block;
		}
		.paper-drawer-panel,
		.editor{
			width: 100%;
			height: 100%;
		}

		*{
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		#dropArea{
			/* create a z-index context to avoid nodes to "leak" outwards */
			position: relative;
			z-index: 0;
		}

	</style>

	<template>

		<paper-drawer-panel
			right-drawer
			drawer-width="200px">
			<qb-ui-nodes-menu
				drawer

				id="menu"
				visual-editor="{{visualEditor}}"
				tree-manager="{{treeManager}}"
				node-definitions="{{nodeDefinitions}}"
				taxonomy-definitions="{{taxonomyDefinitions}}">
			</qb-ui-nodes-menu>
			<div
				id="dropArea"
				main>
				<qb-ui-editor-visual
					hidden$="[[!visualMode]]"
					class="editor"
					self="{{visualEditor}}"
					model="{{model}}"
					model-controller="{{modelController}}"
					tree-manager="{{treeManager}}"
					node-definitions="{{nodeDefinitions}}"
					tree-manager="{{treeManager}}"
					constant-definitions="{{constantDefinitions}}">
				</qb-ui-editor-visual>
				<qb-ui-editor-text
					hidden$="[[!textMode]]"
					class="editor"
					self="{{textEditor}}"
					computed-code="{{computedCode}}">
				</qb-ui-editor-text>
			</div>
		</paper-drawer-panel>
	</template>
</dom-module>
<script>
(function () {
	window.Quirkbot = window.Quirkbot || {};
	window.Quirkbot.UIEditor = Polymer({
		is: 'qb-ui-editor',
		properties: {
			model: Object,
			modelController: {
				type: Object
			},
			treeManager: Object,
			computedCode: String,
			nodeDefinitions: Object,
			constantDefinitions: Object,
			taxonomyDefinitions: Object,
			mode:{
				type: String,
				value: 'visual',
				notify: true,
				observer: '_modeChanged'
			},
			visualEditor: Object,
			textEditor: Object,
			visualMode: Boolean,
			textMode: Boolean
		},
		_modeChanged: function (mode) {
			if(mode === 'text'){
				this.textMode = true;
				this.visualMode = false;
				if(this.treeManager){
					this.treeManager.computeCode();
				}
			}
			else {
				this.textMode = false;
				this.visualMode = true;
			}
		},
		attached: function () {
			this.$.menu.dropArea = this.$.dropArea;
		}
	});
})();
</script>
