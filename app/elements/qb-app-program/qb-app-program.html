<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">

<link rel="import" href="../qb-core-auth/qb-core-auth.html">
<link rel="import" href="../qb-core-i18n/qb-core-i18n.html">
<link rel="import" href="../qb-core-router/qb-core-router.html">
<link rel="import" href="../qb-core-node-definitions/qb-core-node-definitions.html">
<link rel="import" href="../qb-core-model-controller/qb-core-model-controller.html">
<link rel="import" href="../qb-core-tree-manager/qb-core-tree-manager.html">

<link rel="import" href="../qb-ui-styles/qb-ui-styles.html">
<link rel="import" href="../qb-ui-icons/qb-ui-icons.html">
<link rel="import" href="../qb-ui-editor/qb-ui-editor.html">
<link rel="import" href="../qb-ui-toolbar/qb-ui-toolbar.html">
<link rel="import" href="../qb-ui-quirkbots-area/qb-ui-quirkbots-area.html">
<link rel="import" href="../qb-ui-warnings-overlay/qb-ui-warnings-overlay.html">

<dom-module id='qb-app-program'>
	<style>
		:host{
			display: block;
			width: 100%;
			height: 100%;
		}
		qb-ui-toolbar{
			z-index: 1;
		}

	</style>
	<template>

		<qb-core-i18n
			url-format="{{stringsUrl}}"
			locale="{{locale}}">
		</qb-core-i18n>

		<qb-core-auth
			id="auth"
			auth-url="[[authUrl]]"
			api-url="[[apiUrl]]"
			client-id="[[clientId]]">
		</qb-core-auth>

		<qb-core-node-definitions
			url="[[nodesUrl]]"
			nodes="{{nodeDefinitions}}"
			groups="{{groupDefinitions}}"
			constants="{{constantDefinitions}}"
			taxonomies="{{taxonomyDefinitions}}">
		</qb-core-node-definitions>

		<qb-core-model-controller
			_id="{{programId}}"
			api="{{programsApiUrl}}"
			self="{{modelController}}"
			model="{{model}}">
		</qb-core-model-controller>

		<qb-core-tree-manager
			self="{{treeManager}}"
			compiler-url="{{compilerUrl}}"
			computed-code="{{computedCode}}"
			model-controller="{{modelController}}"
			model="{{model}}"
			node-definitions="{{nodeDefinitions}}"
			constant-definitions="{{constantDefinitions}}">
		</qb-core-tree-manager>

		<qb-ui-quirkbots-area
			self="{{quirkbotsArea}}"
			chrome-webstore-id="{{chromeWebstoreId}}"
			tree-manager="{{treeManager}}">
		</qb-ui-quirkbots-area>

		<qb-ui-warnings-overlay
			model="{{model}}">
		</qb-ui-warnings-overlay>

		<paper-header-panel mode="seamed">

			<qb-ui-toolbar
				class="paper-header"
				editor-mode={{editorMode}}
				model="{{model}}"
				on-quirkbots-area-button-tap="_onQuirkbotsAreaButtonTap">
			</qb-ui-toolbar>

			<qb-ui-editor
				class="fit"
				mode={{editorMode}}
				model="{{model}}"
				model-controller="{{modelController}}"
				tree-manager="{{treeManager}}"
				computed-code="{{computedCode}}"
				node-definitions="{{nodeDefinitions}}"
				constant-definitions="{{constantDefinitions}}"
				taxonomy-definitions="{{taxonomyDefinitions}}">
			</qb-ui-editor>

		</paper-header-panel>

	</template>
</dom-module>

<script>
(function () {
	window.Quirkbot = window.Quirkbot || {};
	window.Quirkbot.AppProgram = Polymer({
		is: 'qb-app-program',
		properties: {
			programId: String,
			locale: {
				type: String,
				value: 'en_US'
			},
			programsApiUrl: {
				type: String,
				value: 'http://localhost:8585/api/programs/'
			},
			compilerUrl: {
				type: String,
				value: 'https://quirkbot-compiler.herokuapp.com/'
			},
			nodesUrl: {
				type: String,
				value: 'data/nodes.json'
			},
			stringsUrl: {
				type: String,
				value: 'data/strings/{{locale}}.json'
			},
			chromeWebstoreId: {
				type: String,
				value: 'ackaalhbfjagidmjlhlokoblhbnahegd'
			},
			modelController: {
				type: Object
			},
			model: Object,
			treeManager: Object,
			nodeDefinitions: Array,
			constantDefinitions: Array,
			taxonomyDefinitions: Object,
			editorMode: String,
			quirkbotsArea: Object,
		},
		_onQuirkbotsAreaButtonTap: function(){
			this.quirkbotsArea.open();
		}
	});
})();
</script>
