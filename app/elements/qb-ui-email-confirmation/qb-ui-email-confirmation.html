<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../qb-behavior-utils/qb-behavior-utils.html">
<link rel="import" href="../qb-core-i18n/qb-core-i18n.html">
<link rel="import" href="../qb-ui-icons/qb-ui-icons.html">

<dom-module id='qb-ui-email-confirmation'>

	<template>
		<style include="qb-dialog-styles"></style>
		<style>
			:host{
				display: block;
			}
			iron-icon{
				margin-right: 10px;
			}
			.more-info{
				cursor: pointer;
				margin-left: 10px;
				color: var(--qb-interactive-color);
			}
			.user-email{
				color: var(--qb-action-color);
				font-size: 1.2em;
				font-style: normal;
				margin: 1em 0;
			}
		</style>


		<paper-toast
			id="emailConfirmationNotice"
			duration="99999999999">
			<iron-icon
				icon="[[resolveIconName('info', 'qb-icons')]]">
			</iron-icon>
			<qb-core-i18n
				key="ide/email-confirmation/reminder"></qb-core-i18n>
			<span class="more-info">
				<qb-core-i18n
					role="button" tabindex="0"
					key="ide/email-confirmation/reminder/more-info"
					on-tap="_openDialog"></qb-core-i18n>
			</span>
		</paper-toast>

		<paper-dialog
			modal
			entry-animation="scale-up-animation"
			exit-animation="fade-out-animation"
			class="dialog large"
			id="dialog">
			<h2
				class="dialog-header">
				<qb-core-i18n
					key="ide/email-confirmation/dialog/header"></qb-core-i18n>
			</h2>

			<div
				class="dialog-content">
				<h3 class="header">
					<qb-core-i18n
						key="ide/email-confirmation/dialog/title"></qb-core-i18n>

				</h3>
				<div class="user-email">[[user.email]]</div>

				<qb-core-i18n
					key="ide/email-confirmation/dialog/description"></qb-core-i18n>
			</div>

			<div
				class="buttons">
				<paper-button
					dialog-dismiss>
					<qb-core-i18n
						key="ide/email-confirmation/dialog/cancel"></qb-core-i18n>
				</paper-button>
				<paper-button
					dialog-confirm
					on-tap='_onConfirmTap'>
					<qb-core-i18n
						key="ide/email-confirmation/dialog/continue"></qb-core-i18n>
				</paper-button>
			</div>

		</paper-dialog>

	</template>
</dom-module>

<script>
(function () {
	window.Quirkbot = window.Quirkbot || {};
	window.Quirkbot.UIEmailConfirmation = Polymer({
		is: 'qb-ui-email-confirmation',
		properties: {
			user: {
				type: Object
			}
		},
		behaviors:[
			window.Quirkbot.UtilsBehavior
		],
		observers:[
			'_computeEmailConfirmationNotice(user.confirmedEmail)'
		],
		_computeEmailConfirmationNotice: function (confirmed) {
			if(confirmed){
				this.$.emailConfirmationNotice.hide();
			}
			else{
				this.debounce('emailConfirmationNotice.show',this.$.emailConfirmationNotice.show.bind(this.$.emailConfirmationNotice), 1000);
			}
		},
		_openDialog: function () {
			this.$.dialog.open();
			this.debounce('open dialog', this.$.dialog.notifyResize.bind(this.$.dialog), 1000);
		},
		_onConfirmTap: function () {
			this.fire('resend-confirmation-requested');
		}
	});
})();
</script>
