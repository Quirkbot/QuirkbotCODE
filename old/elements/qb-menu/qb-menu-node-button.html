<link rel="import" href="../qb.html">

<polymer-element name="qb-menu-node-button" attributes="node">

<template>

	<style>
		paper-button{
			margin:0;
			width: 100%;
			text-align: left;
		}
		paper-button::shadow{
	
			text-align: left;
		}
	</style>

	<qb-globals data="{{globals}}"></qb-globals>

	<core-drag-drop on-drag-start="{{dragStart}}"></core-drag-drop>

	<core-item icon="favorite" label="{{node.name}}" ></core-item>

	<div id="avatar-containter" hidden>
		<core-item icon="favorite" label="{{node.name}}" id="avatar"></core-item>
	</div>
	
</template>
<script>
	Polymer({
		dragStart: function (e) {
			var dragInfo = e.detail;
			dragInfo.avatar.appendChild(this.$.avatar);
			dragInfo.drag = function() {};
			dragInfo.drop = this.drop.bind(this);
		},
		drop: function (dragInfo) {
			this.$['avatar-containter'].appendChild(dragInfo.avatar.querySelector('#avatar'));
			
			var editor = this.globals['qb-elements']['qb-editor'];
			var editorBoundaries = editor.getBoundingClientRect();
			

			if(dragInfo.event.pageX < editorBoundaries.left
				|| dragInfo.event.pageX > editorBoundaries.left + editorBoundaries.width
				|| dragInfo.event.pageY < editorBoundaries.top 
				|| dragInfo.event.pageY > editorBoundaries.top + editorBoundaries.height)
				return;

			var data = {};
			data.node = this.node;
			data.visualPosition = {
				x : dragInfo.event.pageX - editorBoundaries.left,
				y : dragInfo.event.pageY - editorBoundaries.top
			};
			this.globals.tree.push(data);
		}

	});
</script>

</polymer-element>