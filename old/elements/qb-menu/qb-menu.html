<link rel="import" href="../qb.html">

<polymer-element name="qb-menu">

<template>

	<style>
		:host{
			overflow-y: scroll;
			background-color: #cccccc; 
		}
		core-menu,
		core-submenu::shadow #submenu {
		 	margin: 0;
		}
		* {
			-moz-user-select: none;
			-khtml-user-select: none;
			-webkit-user-select: none;
			user-select: none;
		}
	</style>

	<qb-globals data="{{data}}"></qb-globals>

	<template repeat="{{data.nodesArray | sortByProperty('name') | sortByProperty('group') | arrangeInGroups }}">
		<core-menu selected="0">
			<core-submenu label="{{name}}">
				<template repeat="{{nodesArray}}">
					<qb-menu-node-button node="{{}}"></qb-menu-node-button>
				</template>
			</core-submenu>
		</core-menu>
	</template>

</template>

<script>
	Polymer({
		sortByProperty : function(array, property){
			array.sort(function(a,b){
				if(a[property] < b[property]) return -1;
				else if(a[property] > b[property]) return 1;
				
				return 0;
			})
			return array;
		},
		arrangeInGroups: function (nodesArray) {
			var groupsArray = [];
			var groups = {};
			for (var i = 0; i < nodesArray.length; i++) {
				if(!groups[nodesArray[i].group]){
					groups[nodesArray[i].group] = {
						name: nodesArray[i].group,
						nodesArray: []
					}
				};
				groups[nodesArray[i].group].nodesArray.push(nodesArray[i]);
			};
			for(var name in groups){
				groupsArray.push(groups[name])
			}
			return groupsArray;
		}
	});
</script>

</polymer-element>